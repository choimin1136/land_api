<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>이집어때?</title>
    
</head>
<body>
<style>
/* table, th, td {
  border: 1px solid gray;
  border-collapse: collapse;
} */
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
</style>
<div id="map" style="width:100%;height:500px;"></div>
<table id="resultList">[결과]
    <th>
        번호
        <td>아파트 명</td>
        <td>세대 수</td>
        <td>도로명 주소</td>
    </th>
</table>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=41979012af7316007a2ae8c472e26718"></script>
</body>
<script>
// 페이지 로드 시에 API 호출
document.addEventListener("DOMContentLoaded", async () => {
            try {
                const response = await fetch("http://localhost:8000/apt/");  // API 엔드포인트 URL
                const data = await response.json();
                // document.getElementById("result").textContent = JSON.stringify(data, null, 2);
                const resultList = document.getElementById("resultList");
                idx=1
                for (const item of data) {
                    const tr = document.createElement("tr");
                    const td = document.createElement("td");
                    const td1 = document.createElement("td");
                    const td2 = document.createElement("td");
                    const td3 = document.createElement("td");
                    td.textContent = idx++
                    td1.textContent = item.name
                    td2.textContent = item.apt_gene + '세대'
                    td3.textContent = item.road_addr
                    tr.appendChild(td);  // 가져온 데이터에서 원하는 속성 사용
                    tr.appendChild(td1);  // 가져온 데이터에서 원하는 속성 사용
                    tr.appendChild(td2);  // 가져온 데이터에서 원하는 속성 사용
                    tr.appendChild(td3);  // 가져온 데이터에서 원하는 속성 사용
                    // tr.textContent = '<td>' +item.name + '</td> <td>' + item.apt_gene + '세대</td><td>' + item.road_addr+'</td>';  // 가져온 데이터에서 원하는 속성 사용
                    resultList.appendChild(tr);
                };

                var positions = [];

                for (const item of data){
                    const position = {
                        content: '<div>'+item.name+'</div>',
                        latlng: new kakao.maps.LatLng(item.y, item.x)
                    };
                    positions.push(position)
                }

                const map = new kakao.maps.Map(document.getElementById('map'), {
                    center: new kakao.maps.LatLng(37.566535, 126.9779692),
                    level: 5
                });

                for (const pos of positions) {
                const marker = new kakao.maps.Marker({
                    map: map,
                    position: pos.latlng
                });

                const infowindow = new kakao.maps.InfoWindow({
                    content: pos.content
                });

                kakao.maps.event.addListener(marker, 'mouseover', function() {
                    infowindow.open(map, marker);
                });

                kakao.maps.event.addListener(marker, 'mouseout', function() {
                    infowindow.close();
                });
            }

            } catch (error) {
                console.error("Error fetching data:", error);
            }
        });
// var mapContainer = document.getElementById('map'), // 지도를 표시할 div  
//     mapOption = { 
//         center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
//         level: 3 // 지도의 확대 레벨
//     };

// var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
    
// 마커를 표시할 위치와 내용을 가지고 있는 객체 배열입니다 
// var positions = [
//     {
//         content: '<div>'+data.name+'</div>', 
//         latlng: new kakao.maps.LatLng(33.450705, 126.570677)
//     },
//     {
//         content: '<div>생태연못</div>', 
//         latlng: new kakao.maps.LatLng(33.450936, 126.569477)
//     },
//     {
//         content: '<div>텃밭</div>', 
//         latlng: new kakao.maps.LatLng(33.450879, 126.569940)
//     },
//     {
//         content: '<div>근린공원</div>',
//         latlng: new kakao.maps.LatLng(33.451393, 126.570738)
//     }
// ];



// for (var i = 0; i < positions.length; i ++) {
//     // 마커를 생성합니다
//     var marker = new kakao.maps.Marker({
//         map: map, // 마커를 표시할 지도
//         position: positions[i].latlng // 마커의 위치
//     });

//     // 마커에 표시할 인포윈도우를 생성합니다 
//     var infowindow = new kakao.maps.InfoWindow({
//         content: positions[i].content // 인포윈도우에 표시할 내용
//     });

//     // 마커에 mouseover 이벤트와 mouseout 이벤트를 등록합니다
//     // 이벤트 리스너로는 클로저를 만들어 등록합니다 
//     // for문에서 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
//     kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
//     kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
// }

// // 인포윈도우를 표시하는 클로저를 만드는 함수입니다 
// function makeOverListener(map, marker, infowindow) {
//     return function() {
//         infowindow.open(map, marker);
//     };
// }

// // 인포윈도우를 닫는 클로저를 만드는 함수입니다 
// function makeOutListener(infowindow) {
//     return function() {
//         infowindow.close();
//     };
// }

/* 아래와 같이도 할 수 있습니다 */
/*
for (var i = 0; i < positions.length; i ++) {
    // 마커를 생성합니다
    var marker = new kakao.maps.Marker({
        map: map, // 마커를 표시할 지도
        position: positions[i].latlng // 마커의 위치
    });

    // 마커에 표시할 인포윈도우를 생성합니다 
    var infowindow = new kakao.maps.InfoWindow({
        content: positions[i].content // 인포윈도우에 표시할 내용
    });

    // 마커에 이벤트를 등록하는 함수 만들고 즉시 호출하여 클로저를 만듭니다
    // 클로저를 만들어 주지 않으면 마지막 마커에만 이벤트가 등록됩니다
    (function(marker, infowindow) {
        // 마커에 mouseover 이벤트를 등록하고 마우스 오버 시 인포윈도우를 표시합니다 
        kakao.maps.event.addListener(marker, 'mouseover', function() {
            infowindow.open(map, marker);
        });

        // 마커에 mouseout 이벤트를 등록하고 마우스 아웃 시 인포윈도우를 닫습니다
        kakao.maps.event.addListener(marker, 'mouseout', function() {
            infowindow.close();
        });
    })(marker, infowindow);
}
*/
</script>
</html>